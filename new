Perfect â€” thanks for clarifying!

Since you already have `attribution.service.ts` inside the `services/` folder, weâ€™ll do the following:

---

### âœ… Final Structure

**Frontend folder setup:**

```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ features/
â”‚   â”‚   â””â”€â”€ attribution/
â”‚   â”‚       â”œâ”€â”€ attribution.component.ts
â”‚   â”‚       â””â”€â”€ attribution.component.html
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ attribution.service.ts  â† Weâ€™ll add chat logic here
```

---

### âœ… Step-by-Step Update

#### 1. **Update `attribution.service.ts`**

Add this function to handle the chat API call:

```ts
sendChat(
  model: string,
  temperature: number,
  dataJson: any,
  history: { role: 'user' | 'assistant', content: string }[],
  userQuery: string
): Observable<{ response: string }> {
  const url = 'http://localhost:5000/chat';
  return this.http.post<{ response: string }>(url, {
    model,
    temperature,
    dataJson,
    history,
    userQuery
  });
}
```

> ğŸ’¡ Make sure `HttpClient` is already injected in the constructor:

```ts
constructor(private http: HttpClient) {}
```

---

#### 2. **Use it inside `attribution.component.ts`**

Update the constructor:

```ts
constructor(private attributionService: AttributionService) {}
```

Then use:

```ts
sendChat() {
  const query = this.chatInput.trim();
  if (!query) return;

  this.chatHistory.push({ role: 'user', content: query });
  this.chatInput = '';
  this.isChatLoading = true;

  const history = this.chatHistory.slice(-6); // trim to recent messages
  this.attributionService.sendChat(
    this.llmModel,
    this.temperature,
    this.attributionJson,  // store this during generate prompt
    history,
    query
  ).subscribe({
    next: (res) => {
      this.chatHistory.push({ role: 'assistant', content: res.response });
      this.isChatLoading = false;
    },
    error: (err) => {
      console.error('Chat error:', err);
      this.chatHistory.push({ role: 'assistant', content: 'âš ï¸ Error getting response.' });
      this.isChatLoading = false;
    }
  });
}
```

---

Let me know when this is working â€” then weâ€™ll build the backend `/chat` route in Flask to receive and respond!
