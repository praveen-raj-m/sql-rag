// 📁 legaldoc.component.ts
import { Component } from '@angular/core';

interface ChatMessage {
  role: 'user' | 'assistant';
  content: string;
}

@Component({
  selector: 'app-legaldoc',
  templateUrl: './legaldoc.component.html',
  styleUrls: ['./legaldoc.component.css']
})
export class LegaldocComponent {
  activeTab: 'generate' | 'chat' = 'generate';

  analystName: string = '';
  analysisDate: string = '';

  templateText: string = '';
  agreementText: string = '';
  prompt: string = '';

  llmModel: string = 'llama3';
  temperature: number = 0.7;

  commentaryResult: string = '';
  isGenerating: boolean = false;

  chatInput: string = '';
  chatHistory: ChatMessage[] = [];

  switchTab(tab: 'generate' | 'chat') {
    if (tab === 'chat' && (!this.templateText || !this.agreementText)) return;
    this.activeTab = tab;
  }

  goBackToLanding() {
    if (confirm('End this analysis and return to home? All data will be lost.')) {
      window.location.href = '/';
    }
  }

  onFileUpload(event: any, target: 'template' | 'agreement') {
    const file = event.target.files[0];
    const reader = new FileReader();
    reader.onload = () => {
      if (target === 'template') this.templateText = reader.result as string;
      else this.agreementText = reader.result as string;
    };
    reader.readAsText(file);
  }

  generatePrompt() {
    this.prompt = `You are a legal analyst. Compare the following agreements.\n\nTemplate:\n${this.templateText}\n\nAgreement:\n${this.agreementText}`;
  }

  generateCommentary() {
    this.isGenerating = true;
    setTimeout(() => {
      this.commentaryResult = `**AI Generated Commentary**\n\nBased on the comparison, several clauses differ...`;
      this.isGenerating = false;
    }, 1000);
  }

  sendChat() {
    if (!this.chatInput.trim()) return;
    const msg: ChatMessage = { role: 'user', content: this.chatInput.trim() };
    this.chatHistory.push(msg);
    this.chatInput = '';

    setTimeout(() => {
      this.chatHistory.push({ role: 'assistant', content: 'This clause appears to differ from the template.' });
    }, 600);
  }

  clearChat() {
    this.chatHistory = [];
  }
}
