<div class="container">
  <!-- Header -->
  <div class="page-header">
    <h2>Legal Document Analysis</h2>
    <button class="end-btn" (click)="goBackToLanding()">‚Üê Back</button>
  </div>

  <!-- Tabs -->
  <div class="tab-selector">
    <button [class.active]="activeTab === 'generate'" (click)="switchTab('generate')">Generate Commentary</button>
    <button [class.active]="activeTab === 'chat'" [disabled]="!templateText || !agreementText" (click)="switchTab('chat')">Chat with Data</button>
  </div>

  <!-- Commentary Tab -->
  <div *ngIf="activeTab === 'generate'" class="commentary-form">
    <!-- Upload -->
    <div class="file-upload-row">
      <div>
        <label>Template Document</label>
        <input type="file" (change)="onFileUpload($event, 'template')" />
      </div>
      <div>
        <label>Client Agreement</label>
        <input type="file" (change)="onFileUpload($event, 'agreement')" />
      </div>
    </div>

    <!-- View -->
    <div class="doc-view">
      <textarea [value]="templateText" placeholder="Template Document..." readonly></textarea>
      <textarea [value]="agreementText" placeholder="Client Agreement..." readonly></textarea>
    </div>

    <!-- Meta -->
    <div class="info-row">
      <input type="text" [(ngModel)]="analystName" placeholder="Analyst Name" />
      <input type="date" [(ngModel)]="analysisDate" />
    </div>

    <!-- Prompt -->
    <button class="generate-button" (click)="generatePrompt()">Generate Prompt</button>
    <textarea rows="6" [(ngModel)]="prompt" placeholder="Prompt will appear here..."></textarea>

    <!-- Model/Temp/Download -->
    <div class="controls-row">
      <select [(ngModel)]="llmModel">
        <option value="llama3">LLaMA 3</option>
        <option value="gemma3-12b">Gemma 3:12B</option>
        <option value="gemma3-27b">Gemma 3:27B</option>
      </select>
      <input type="number" [(ngModel)]="temperature" min="0" max="1" step="0.1" />
      <button [disabled]="isGenerating || !commentaryResult">Download Output</button>
    </div>

    <!-- Commentary Output -->
    <button class="generate-button" (click)="generateCommentary()" [disabled]="isGenerating">Generate Commentary</button>
    <div class="markdown-output" *ngIf="commentaryResult" [innerHTML]="commentaryResult | markdown"></div>
  </div>

  <!-- Chat Tab -->
  <div *ngIf="activeTab === 'chat'" class="chat-layout">
    <!-- Left: Document -->
    <div class="chat-left">
      <h4>Document Comparison</h4>
      <div class="doc-scroll">
        <h5>Template</h5>
        <pre>{{ templateText }}</pre>
        <h5>Agreement</h5>
        <pre>{{ agreementText }}</pre>
      </div>
    </div>

    <!-- Right: Chat -->
    <div class="chat-right">
      <div class="summary-box">
        <h4>Summary</h4>
        <p>This will contain an AI-generated summary of key differences.</p>
      </div>

      <div class="chat-controls">
        <select [(ngModel)]="llmModel">
          <option value="llama3">LLaMA 3</option>
          <option value="gemma3-12b">Gemma 3:12B</option>
          <option value="gemma3-27b">Gemma 3:27B</option>
        </select>
        <button (click)="clearChat()">Clear Chat</button>
      </div>

      <div class="chat-history">
        <div *ngFor="let msg of chatHistory" class="chat-message" [ngClass]="msg.role">
          <strong *ngIf="msg.role === 'user'">You:</strong>
          <strong *ngIf="msg.role === 'assistant'">AI:</strong>
          <span>{{ msg.content }}</span>
        </div>
      </div>

      <div class="chat-input-box">
        <input [(ngModel)]="chatInput" placeholder="Ask about the documents..." />
        <button (click)="sendChat()">Send</button>
      </div>
    </div>
  </div>
</div>
