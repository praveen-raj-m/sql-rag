Perfect â€” letâ€™s implement **Step 2: Add the â€œDownload Outputâ€ `.doc` button** to the **Commentary tab** of the Attribution page.

---

## âœ… Step 2: Add Download Output Button

### ğŸ“„ Update `attribution.component.html`

Find and **replace the current Download Prompt button** with:

```html
<button
  [disabled]="!renderedMarkdown"
  (click)="downloadOutput()"
>
  Download Output (.doc)
</button>
```

You can place it next to the temperature/model controls or below the markdown output â€” up to you for visual flow.

---

### ğŸ§  Behavior Recap

* The button is **disabled until `renderedMarkdown` is non-empty**
* Filename is: `AnalystName_AnalysisDate_LLMCommentary.doc`
* Contents of the `.doc` file include:

  * Analyst name
  * Date
  * Input data
  * LLM output
  * Prompt text
  * Disclaimer

---

### ğŸ“„ Add `downloadOutput()` Method in `attribution.component.ts`

```ts
downloadOutput() {
  const name = this.analystName.trim() || 'Analyst';
  const date = this.analysisDate || new Date().toISOString().split('T')[0];

  const docName = `${name}_${date}_LLMCommentary.doc`.replace(/\s+/g, '_');

  const docContent = `
Analyst: ${name}
Date: ${date}

----------------------------------------
Attribution Input:
${this.attributionData}

----------------------------------------
AI Commentary Output:
${this.stripMarkdown(this.renderedMarkdown)}

Disclaimer:
This commentary is AI-generated. Please review before relying on it.

----------------------------------------
Prompt Sent to Model:
${this.promptText}
`;

  const blob = new Blob([docContent], {
    type: 'application/msword'
  });

  const link = document.createElement('a');
  link.href = window.URL.createObjectURL(blob);
  link.download = docName;
  link.click();

  window.URL.revokeObjectURL(link.href);
}
```

### Add Helper to Remove Markdown (Basic)

Also add this method inside the same component:

```ts
stripMarkdown(md: string): string {
  return md
    .replace(/[#_*`>~-]+/g, '') // remove markdown symbols
    .replace(/\n{2,}/g, '\n\n'); // normalize spacing
}
```

---

### âœ… Result

You now have:

* A clean **Download Output (.doc)** button
* Disabled when no commentary is generated
* Outputs a readable `.doc` with analyst info, input, output, prompt, and disclaimer

---

Let me know once you test it â€” and weâ€™ll move on to **Step 3: Build the Chat Tab layout and table preview**.
