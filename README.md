# SQL RAG Dashboard

A fully local dashboard that lets you query, manage, and build SQL databases using natural language powered by a local LLM (LLaMA 3.2 via Ollama).

## Features

- **Natural Language to SQL**: Ask questions in plain English and get SQL queries and results
- **Advanced Query Capabilities**: Support for complex operations including:
  - Counting null values in columns
  - Finding averages, maximums, and minimums
  - Calculating sums and counting distinct values
  - Text analysis (word count, character count)
- **Model Configuration Panel (MCP)**: Intelligent system that ensures accurate query generation:
  - Schema validation for table and column references
  - Context enrichment with database structure
  - Metadata-aware query generation
- **Table Management**: Create, view, and delete tables with an intuitive interface
- **Data Management**:
  - Step-by-step table creation with column type dropdowns
  - Manual row insertion
  - Bulk CSV upload (append or create new tables)
- **Relationship Management**: Create foreign key relationships between tables
- **Fully Local Execution**: No external APIs or cloud services required
- **Interactive Dashboard**: Built with Gradio for a user-friendly experience

## Sample Tables

The repository includes scripts to create these sample tables:

1. **Products**: Product inventory with name, category, price, stock, and description
2. **Employees**: Employee records with names, positions, departments, salaries
3. **Orders**: Customer order information with payment methods and status

## Getting Started

### Prerequisites

- Python 3.8 or higher
- [Ollama](https://ollama.ai/) installed locally

### Installation

```bash
# Clone the repository
git clone https://github.com/yourusername/sql-rag-dashboard.git
cd sql-rag-dashboard

# Create a virtual environment
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate

# Install dependencies
pip install -r requirements.txt

# Start Ollama with LLaMA 3.2
ollama pull llama3
ollama run llama3
```

### Running the Dashboard

```bash
python app.py
```

Visit `http://localhost:7860` to use the application.

### Setting up sample data

To create sample tables:

```bash
python create_sample_tables.py
```

## Database Management Tools

Several tools are included to help manage your database:

```bash
# List all tables
python db_manager.py list

# Delete a specific table
python db_manager.py delete <table_name>

# Create a sample users table
python db_manager.py create-users

# Refresh the schema
python db_manager.py refresh-schema
```

For a detailed guide, see [README_DB_TOOLS.md](README_DB_TOOLS.md).

## Example Natural Language Queries

The MCP-enhanced system can handle complex queries with accurate SQL generation:

- "Show all products in the Electronics category"
- "What is the average salary of employees in the Engineering department?"
- "How many orders have a status of Shipped?"
- "Count null values in the total_amount column of the orders table"
- "Find the maximum price in the products table"
- "What is the sum of stock for Kitchen products?"
- "Which employee has the highest salary in each department?"
- "Count the number of words in all product descriptions"
- "What's the total amount of all completed orders?"

Even when tables and columns have complex names or mixed conventions, MCP ensures the correct SQL is generated by maintaining a detailed schema representation.

## Technical Details

- **SQLite Database**: Lightweight, serverless database stored as `sqlite.db`
- **LLaMA 3.2 Integration**: Leverages local LLM capabilities via Ollama
- **MCP Architecture**: Custom-built Model Configuration Panel for enhanced LLM-database interaction
  - Uses Pydantic models for schema validation
  - Maintains real-time database schema representation
  - Dynamically generates context-aware prompts
- **Gradio Interface**: Interactive web UI with real-time query results
- **Dynamic Schema Management**: JSON-based metadata system for table and column information
- **Error Resilience**: Robust error handling for schema mismatches and invalid queries

## Model Configuration Panel (MCP)

The SQL RAG Dashboard includes a Model Configuration Panel that helps manage the interaction between natural language and SQL conversion:

### Features

- **Schema Validation**: Automatically validates table schemas to ensure queries reference existing tables and columns
- **Query Templates**: Stores and manages predefined query templates for common operations
- **Error Handling**: Gracefully handles mismatches between user requests and database schema
- **Metadata Management**: Tracks column descriptions and data types for better query generation
- **Context Enrichment**: Provides the LLM with detailed database context for more accurate SQL generation

The MCP improves query accuracy by ensuring generated SQL is always compatible with your database structure, even as it evolves over time.

## License

[MIT](LICENSE)

## Acknowledgements

- [LLaMA 3.2](https://ai.meta.com/llama/) by Meta AI
- [Ollama](https://ollama.ai/) for local LLM hosting
- [Gradio](https://www.gradio.app/) for the web interface
